#!/bin/sh
# Pre-commit hook - runs fast checks before commit

echo "üîç Running pre-commit checks..."

# Validate CI configuration
bash scripts/validate-ci.sh || exit 1

# Validate no cross-project dependencies
echo "‚Üí Validating no cross-project dependencies..."
if grep -r "cd.*\.\./backend[^-]" backend-v2/ 2>/dev/null | grep -v "Binary file" | grep -v ".git"; then
    echo "‚ùå backend-v2/ references ../backend/ (cross-project dependency violation)"
    echo "   backend-v2 must be self-contained for CI stability"
    exit 1
fi

make ci-local

if [ $? -ne 0 ]; then
    echo "‚ùå Pre-commit checks failed. Commit aborted."
    echo "   Fix errors and try again, or use 'git commit --no-verify' to skip."
    exit 1
fi

echo "‚úÖ Pre-commit checks passed"
exit 0
